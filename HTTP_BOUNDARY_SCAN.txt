// FILE: public/index.php
// ...
// 4ï¸âƒ£ Boot & Run
AdminKernel::bootWithOptions($options)->run();


// FILE: app/Modules/AdminKernel/Kernel/AdminKernel.php
// ...
        // HTTP bootstrap (body parsing, error middleware, etc.)
        $bootstrap = $options->bootstrap ?? require __DIR__ . '/../Bootstrap/http.php';
        $bootstrap($app);
// ...


// FILE: app/Modules/AdminKernel/Bootstrap/http.php
// ...
    // ðŸ†• Unified Maatify Exception Handler
    $errorMiddleware->setErrorHandler(
        MaatifyException::class,
        function (
            ServerRequestInterface $request,
            MaatifyException $exception
        ) use ($app): ResponseInterface {

            $payload = [
                'success' => false,
                'error' => [
                    'code'      => $exception->getErrorCode()->value,
                    'category'  => $exception->getCategory()->value,
                    'message'   => $exception->isSafe()
                        ? $exception->getMessage()
                        : 'Internal Server Error',
                    'meta'      => $exception->getMeta(),
                    'retryable' => $exception->isRetryable(),
                ],
            ];

            $response = $app->getResponseFactory()
                ->createResponse($exception->getHttpStatus());

            $response->getBody()->write(
                json_encode($payload, JSON_THROW_ON_ERROR)
            );

            return $response->withHeader('Content-Type', 'application/json');
        },
        true // ðŸ”¥ VERY IMPORTANT â€” handle subclasses
    );
// ...
    // 6ï¸âƒ£ â— LAST â€” catch-all
    $errorMiddleware->setErrorHandler(
        Throwable::class,
        function (
            ServerRequestInterface $request,
            Throwable $exception,
            bool $displayErrorDetails
        ) use ($app) {
// ...
            throw $exception;
        }
    );


// FILE: app/Modules/AdminKernel/Http/Response/JsonResponseFactory.php
// ...
final class JsonResponseFactory
{
// ...
    /**
     * Legacy manual error (Backward compatibility)
     */
    public function error(
        ResponseInterface $response,
        string $message,
        int $status = 400,
        string $code = 'error',
        array $meta = []
    ): ResponseInterface {

        $payload = [
            'success' => false,
            'error' => [
                'code'    => $code,
                'message' => $message,
                'meta'    => $meta,
            ],
        ];

        return $this->data($response, $payload, $status);
    }
// ...
}


// ERROR STRUCTURES FOUND
// 1. MaatifyException (Bootstrap/http.php):
// {
//     "success": false,
//     "error": {
//         "code": "...",
//         "category": "...",
//         "message": "...",
//         "meta": {},
//         "retryable": false
//     }
// }

// 2. Legacy/Manual (Bootstrap/http.php - ValidationFailedException):
// {
//     "error": "Invalid request payload",
//     "errors": { ... }
// }

// 3. Legacy/Manual (Bootstrap/http.php - HttpBadRequestException):
// {
//     "message": "...",
//     "code": "BAD_REQUEST"
// }

// 4. Manual json_encode (Controllers/StepUpController.php):
// {
//     "error": "Invalid scope"
// }


// CONTROLLER SCAN
// app/Modules/AdminKernel/Http/Controllers/StepUpController.php: Manual json_encode(['error' => ...])
// app/Modules/AdminKernel/Http/Controllers/Api/Admin/AdminController.php: Manual json_encode($responseDto)
// app/Modules/AdminKernel/Http/Controllers/Api/Sessions/SessionRevokeController.php: Manual json_encode(['error' => ...])
