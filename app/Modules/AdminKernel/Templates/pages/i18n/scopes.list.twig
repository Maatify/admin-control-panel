{% extends "layouts/base.twig" %}

{% block title %}I18n Scopes | {{ ui.appName }}{% endblock %}

{% block content %}

    {# ===================================================================
       Capabilities Injection
       Computed server-side. JS reads window.i18nScopesCapabilities.
       =================================================================== #}
    <script>
        window.i18nScopesCapabilities = {
            can_create:      {{ capabilities.can_create      ?? false ? 'true' : 'false' }},
            can_update:      {{ capabilities.can_update      ?? false ? 'true' : 'false' }},
            can_change_code: {{ capabilities.can_change_code ?? false ? 'true' : 'false' }},
            can_set_active:  {{ capabilities.can_set_active  ?? false ? 'true' : 'false' }},
            can_update_sort: {{ capabilities.can_update_sort ?? false ? 'true' : 'false' }},
            can_update_meta: {{ capabilities.can_update_meta ?? false ? 'true' : 'false' }}
        };
    </script>

    {# ===================================================================
       Page Header (breadcrumb + title)
       =================================================================== #}
    <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <div class="flex items-center gap-3">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-100">
                I18n Scopes
            </h2>
            <span class="px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                Management
            </span>
        </div>

        <nav>
            <ol class="flex items-center gap-1.5">
                <li>
                    <a class="inline-flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors"
                       href="{{ ui.adminUrl }}dashboard">
                        Home
                        <svg class="stroke-current" width="17" height="16" viewBox="0 0 17 16" fill="none">
                            <path d="M6.0765 12.667L10.2432 8.50033L6.0765 4.33366"
                                  stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </li>
                <li class="text-sm text-gray-800 dark:text-gray-200">
                    I18n Scopes
                </li>
            </ol>
        </nav>
    </div>

    {# ===================================================================
       Main Content Container
       =================================================================== #}
    <div class="grid grid-cols-1 gap-6">

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900/50 border border-gray-200 dark:border-gray-700">

            {# ============================================================
               üîç Filters & Actions Toolbar
               ============================================================ #}
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <form id="scopes-filter-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

                        {# ID Filter #}
                        <div>
                            <label for="filter-id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                ID
                            </label>
                            <input
                                    type="number"
                                    id="filter-id"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., 1, 2, 3..."
                                    min="1"
                            />
                        </div>

                        {# Name Filter #}
                        <div>
                            <label for="filter-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                üìù Scope Name
                            </label>
                            <input
                                    type="text"
                                    id="filter-name"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., User Profile..."
                            />
                        </div>

                        {# Code Filter #}
                        <div>
                            <label for="filter-code" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                üè∑Ô∏è Scope Code
                            </label>
                            <input
                                    type="text"
                                    id="filter-code"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., user.profile..."
                            />
                        </div>

                        {# Status Filter #}
                        <div>
                            <label for="filter-status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                üìä Status
                            </label>
                            <select
                                    id="filter-status"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                            >
                                <option value="">All Statuses</option>
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </div>

                    {# Action Buttons #}
                    <div class="flex flex-wrap gap-3 pt-4">
                        <button
                                type="submit"
                                class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            Search
                        </button>

                        <button
                                type="button"
                                id="scopes-reset-filters"
                                class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Reset
                        </button>

                        {# Create Scope Button (Shown only if can_create capability exists) #}
                        {% if capabilities.can_create %}
                            <button
                                    type="button"
                                    id="btn-create-scope"
                                    class="ml-auto px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Create Scope
                            </button>
                        {% endif %}
                    </div>
                </form>
            </div>

            {# ============================================================
               üìã Scopes Table Container (Rendered by JS)
               ============================================================ #}

            {# Global Search Bar (Above Table) #}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-4">
                <div class="flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input
                            type="text"
                            id="scopes-search"
                            class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                            placeholder="üîç Quick search by name, code or description..."
                    />
                    <button
                            type="button"
                            id="scopes-search-btn"
                            class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
                    >
                        Search
                    </button>
                    <button
                            type="button"
                            id="scopes-clear-search"
                            class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"
                    >
                        Clear
                    </button>
                </div>
            </div>

            {# Data Table #}
            <div id="table-container" class="w-full"></div>
        </div>
    </div>

    {# ===================================================================
       MODALS
       =================================================================== #}

    {# 1. Create Scope Modal #}
    <div id="create-scope-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg mx-4">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Create New Scope</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-500">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="create-scope-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Code <span class="text-red-500">*</span></label>
                    <input type="text" id="create-code" name="code" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" required maxlength="50">
                    <p class="text-xs text-gray-500 mt-1">Unique identifier (e.g., users.profile)</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name <span class="text-red-500">*</span></label>
                    <input type="text" id="create-name" name="name" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" required maxlength="100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                    <textarea id="create-description" name="description" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" rows="3" maxlength="255"></textarea>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="create-active" name="is_active" class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked>
                    <label for="create-active" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">Active</label>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" class="close-modal px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Create Scope</button>
                </div>
            </form>
        </div>
    </div>

    {# 2. Update Sort Modal #}
    <div id="update-sort-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Update Sort Order</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-500">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="update-sort-form" class="p-6 space-y-4">
                <input type="hidden" id="sort-scope-id" name="id">
                <div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Scope: <span id="sort-scope-name" class="font-semibold text-gray-900 dark:text-gray-100"></span></p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Current Order: <span id="sort-current-order" class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded"></span></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Position <span class="text-red-500">*</span></label>
                    <input type="number" id="sort-new-order" name="position" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" required min="0">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" class="close-modal px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Update Order</button>
                </div>
            </form>
        </div>
    </div>

    {# 3. Change Code Modal #}
    <div id="change-code-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Change Scope Code</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-500">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="change-code-form" class="p-6 space-y-4">
                <input type="hidden" id="code-scope-id" name="id">
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700 dark:text-yellow-200">
                                Changing the scope code may break integrations relying on the old code. Proceed with caution.
                            </p>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Code <span class="text-red-500">*</span></label>
                    <input type="text" id="code-new-code" name="new_code" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" required maxlength="50">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" class="close-modal px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Change Code</button>
                </div>
            </form>
        </div>
    </div>

    {# 4. Update Metadata Modal #}
    <div id="update-metadata-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg mx-4">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Update Scope Metadata</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-500">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="update-metadata-form" class="p-6 space-y-4">
                <input type="hidden" id="meta-scope-id" name="id">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                    <input type="text" id="meta-name" name="name" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" maxlength="100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                    <textarea id="meta-description" name="description" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" rows="3" maxlength="255"></textarea>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                    * At least one field must be provided.
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" class="close-modal px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Update Metadata</button>
                </div>
            </form>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {# Shared infrastructure scripts #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/api_handler.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/callback_handler.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/Input_checker.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/data_table.js') }}"></script>

    {# ‚ú® Select2 - Custom dropdown with search #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/select2.js') }}"></script>

    {# ‚ú® Project-wide reusable UI components library #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/admin-ui-components.js') }}"></script>

    {# Scopes specific script #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/i18n_scopes.js') }}"></script>
{% endblock %}
